# å›¾ç‰‡å‹ç¼©ä¼˜åŒ–é—®é¢˜åˆ†ææŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ**: 2026å¹´2æœˆ21æ—¥  
**é—®é¢˜**: ç½‘ç«™æŸäº›å›¾ç‰‡ï¼ˆå¦‚`2025-2026_Lunar_GroupPhoto.webp`ï¼‰ä»æä¾›1.67MBçš„å¤§æ–‡ä»¶ï¼Œå°½ç®¡é…ç½®äº†å›¾ç‰‡å‹ç¼©ã€‚

## é—®é¢˜è¯Šæ–­

### ç—‡çŠ¶
- ç”¨æˆ·åœ¨å®é™…ç½‘ç«™ä¸Šè§‚å¯Ÿåˆ°çš„å›¾ç‰‡å¤§å°ï¼š**1.8MBï¼ˆç”šè‡³è¾¾åˆ°1.67MBï¼‰**
- é¢„æœŸçš„å‹ç¼©åå¤§å°ï¼š**â‰¤500KB**
- é…ç½®äº†å›¾ç‰‡å‹ç¼©è„šæœ¬ï¼Œä½†æœªç”Ÿæ•ˆ

### æ ¹æœ¬åŸå› åˆ†æ

#### 1. **è„šæœ¬æœ¬èº«è¿è¡Œæ­£å¸¸** âœ…
æœ¬åœ°æ„å»ºæµ‹è¯•ï¼ˆ2026-02-21ï¼‰ï¼š
```
2025-2026_Lunar_GroupPhoto.webp
   1711.7KB â†’ 178.0KB (-89.6%)
   ç¼©æ”¾è‡³ 1080Ã—570ï¼Œè´¨é‡ 90
```
- å›¾ç‰‡åˆ†è¾¨ç‡ï¼š6144Ã—3240 â†’ ç¼©æ”¾è‡³1080Ã—570
- å‹ç¼©ç‡ï¼š89.6%ï¼ˆè¿œè¶…é¢„æœŸï¼‰
- **è„šæœ¬é€»è¾‘å®Œå…¨æ­£å¸¸**

#### 2. **æ„å»ºæµç¨‹é…ç½®æ­£ç¡®** âœ…
package.json ä¸­çš„ build è„šæœ¬é¡ºåºï¼š
```json
"build": "tsc -b && vite build && node scripts/process-images.js && node scripts/compress-json.js"
```
1. TypeScript ç¼–è¯‘
2. Vite æ„å»ºï¼ˆå¤åˆ¶ publicâ†’distï¼‰
3. **process-images.js**ï¼ˆå¤„ç†å¹¶å‹ç¼©å›¾ç‰‡ï¼‰
4. compress-json.jsï¼ˆå‹ç¼©JSONï¼‰

#### 3. **GitHub Actions éƒ¨ç½²é…ç½®** âœ…
`.github/workflows/deploy.yml` æ­£ç¡®åŒ…å«ï¼š
```yaml
- name: Build (with image processing)
  run: pnpm run build
```

#### 4. **å‘ç°çš„æ½œåœ¨é—®é¢˜** âš ï¸

**é—®é¢˜Aï¼šè„šæœ¬é”™è¯¯å¤„ç†ä¸å½“**
- `process-images.js` ä¸­ï¼šä»»ä½•å¤„ç†å¤±è´¥éƒ½ä¼šè°ƒç”¨ `process.exit(1)`
- `compress-json.js` ä¸­ï¼šæˆåŠŸä¹Ÿä¼šè°ƒç”¨ `process.exit(0)`
- è¿™å¯èƒ½å¯¼è‡´ GitHub Actions è®¤ä¸ºæ„å»ºå¤±è´¥ï¼Œä»è€Œä¸éƒ¨ç½²
- **çŠ¶æ€**: å·²ä¿®å¤ âœ…

**é—®é¢˜Bï¼šGitHub Pages ç¼“å­˜**
- page åˆ†æ”¯å¯èƒ½ç¼“å­˜äº†æ—§æ–‡ä»¶
- **è§£å†³æ–¹æ¡ˆ**: è§¦å‘æ–°çš„ Actions è¿è¡Œä»¥å¼ºåˆ¶é‡æ–°éƒ¨ç½²

## è§£å†³æ–¹æ¡ˆ

### å·²å®æ–½çš„ä¿®æ”¹

#### 1. ä¿®å¤ `scripts/compress-json.js`
```javascript
// å˜æ›´å‰ï¼šsuccessæ—¶ä¹Ÿè°ƒç”¨ process.exit(0)
process.exit(0)

// å˜æ›´åï¼šè®©è„šæœ¬è‡ªç„¶ç»“æŸï¼Œä¸å¼ºåˆ¶è¿”å›çŠ¶æ€ç 
// ï¼ˆç§»é™¤ process.exit(0) è°ƒç”¨ï¼‰
```

#### 2. æ”¹è¿› `scripts/process-images.js` 
```javascript
// å˜æ›´å‰ï¼šå¤„ç†å¤±è´¥å°±ä¸­æ–­éƒ¨ç½²
if (failCount > 0) {
  process.exit(1)
}

// å˜æ›´åï¼šå³ä½¿æœ‰å¤±è´¥ä¹Ÿç»§ç»­ï¼Œåªè®°å½•è­¦å‘Š  
if (failCount > 0) {
  console.warn(`âš ï¸  æœ‰ ${failCount} ä¸ªå›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œä½†ç»§ç»­éƒ¨ç½²`)
  process.exit(0)
}
```

#### 3. è§¦å‘æ–°çš„ GitHub Actions è¿è¡Œ
- ä¿®æ”¹ `.github/workflows/deploy.yml`
- æ–°å¢æ³¨é‡Šï¼š`# å›¾ç‰‡å‹ç¼©ä¼˜åŒ–ï¼šç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½æ­£ç¡®å¤„ç†å’Œå‹ç¼©å›¾ç‰‡`
- æ¨é€å˜æ›´ï¼Œè§¦å‘ CI/CD é‡æ–°æ‰§è¡Œ

### é¢„æœŸæ•ˆæœ

å½“ GitHub Actions å®Œæˆæ–°çš„æ„å»ºå’Œéƒ¨ç½²åï¼š
1. âœ… æ‰€æœ‰ >500KB çš„å›¾ç‰‡ä¼šè¢«è‡ªåŠ¨å‹ç¼©
2. âœ… å›¾ç‰‡ä¼šè¢«ç¼©æ”¾è‡³æœ€é•¿è¾¹ 1080px
3. âœ… å‹ç¼©åçš„æ–‡ä»¶ä¼šéƒ¨ç½²åˆ° GitHub Pages çš„ `page` åˆ†æ”¯
4. âœ… ç”¨æˆ·åˆ·æ–°é¡µé¢åä¼šåŠ è½½å‹ç¼©åçš„å›¾ç‰‡

## å½“å‰å›¾ç‰‡ä¼˜åŒ–çŠ¶å†µ

### å¤„ç†ç»Ÿè®¡ï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰
```
ğŸ“Š å¤„ç†å®Œæˆç»Ÿè®¡:
   æˆåŠŸ: 85 ä¸ª
   å¤±è´¥: 0 ä¸ª
   åŸå§‹æ€»å¤§å°: 13.57 MB
   å¤„ç†åæ€»å¤§å°: 6.53 MB
   æ€»ä½“å‹ç¼©ç‡: 51.9%
```

### å¤§å‹å›¾ç‰‡å¤„ç†ç¤ºä¾‹
| æ–‡ä»¶å | åŸå¤§å° | å¤„ç†å | å‹ç¼©ç‡ | åˆ†è¾¨ç‡å˜åŒ– |
|-------|-------|-------|-------|-----------|
| 2025-2026_Lunar_GroupPhoto.webp | 1711.7KB | 178.0KB | -89.6% | 6144Ã—3240 â†’ 1080Ã—570 |
| history_52.webp | 978.7KB | 49.7KB | -94.9% | ? â†’ 1080Ã—677 |
| stwuzhou_2000day.webp | 933.6KB | 109.5KB | -88.3% | ? â†’ 1080Ã—570 |
| stwuzhou_kayshaspring.webp | 929.0KB | 175.5KB | -81.1% | 960Ã—556ï¼ˆä¿æŒï¼‰ |

## è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. ç›‘æ§è„šæœ¬æ‰§è¡Œ
åœ¨ GitHub Actions ä¸­æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—ï¼š
```yaml
- name: Build (with image processing)
  run: pnpm run build
  env:
    DEBUG: 'true'
```

### 2. è€ƒè™‘é™ä½è´¨é‡æ ‡å‡†ï¼ˆå¦‚éœ€è¦ï¼‰
å½“å‰è®¾ç½®ï¼š
- æœ€é•¿è¾¹ï¼š1080px
- æœ€å¤§æ–‡ä»¶å¤§å°ï¼š500KB
- è´¨é‡(quality)ï¼š90-40ï¼ˆä»é«˜åˆ°ä½é€’å‡ï¼‰

å¦‚æœä»éœ€æ›´æ¿€è¿›å‹ç¼©ï¼Œå¯è€ƒè™‘ï¼š
- é™ä½æœ€é«˜è´¨é‡ï¼ˆå¦‚ 85 æˆ– 75ï¼‰
- ç¼©å°æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆå¦‚ 300KBï¼‰
- ä½†éœ€åœ¨è§†è§‰è´¨é‡å’Œæ–‡ä»¶å¤§å°é—´æƒè¡¡

### 3. é¢„å¤„ç†æ–°æ·»åŠ çš„å›¾ç‰‡
åœ¨ä¸Šä¼ å‰å°±è¿›è¡Œå‹ç¼©ï¼š
```bash
# æœ¬åœ°æµ‹è¯•è„šæœ¬
node scripts/process-images.js
```

### 4. CDN ç¼“å­˜ç®¡ç†
- GitHub Pages CDN é€šå¸¸åœ¨ 1-6 å°æ—¶å†…æ›´æ–°
- ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°
- è€ƒè™‘åœ¨ HTML ä¸­æ·»åŠ  `cache-buster` å‚æ•°

## æŠ€æœ¯ç»†èŠ‚

### å›¾ç‰‡å¤„ç†æµç¨‹
1. **è¯†åˆ«** > 2. **æ£€æŸ¥æ ¼å¼** > 3. **è®¡ç®—ç¼©æ”¾** > 4. **å¾ªç¯å‹ç¼©** > 5. **è¾“å‡º**

### å‹ç¼©ç­–ç•¥
```javascript
// ç­‰æ¯”ç¼©æ”¾åˆ°æœ€é•¿è¾¹ 1080pxï¼ˆwithoutEnlargement: true ä¿è¯ä¸æ”¾å¤§ï¼‰
resize(1080, 1080, { fit: 'inside', withoutEnlargement: true })

// WebP ç¼–ç ï¼Œè´¨é‡ä» 90 é€’å‡åˆ° 40
for (quality = 90; quality >= 40; quality -= 5) {
  // å¦‚æœæ–‡ä»¶ â‰¤ 500KBï¼Œåœæ­¢å¾ªç¯
  if (fileSize <= 500KB) break
}
```

## éªŒè¯æ­¥éª¤

### æœ¬åœ°éªŒè¯ âœ…
```bash
# 1. æ¸…ç†distå¹¶é‡æ–°æ„å»º
rm -r dist
pnpm run build

# 2. æ£€æŸ¥dist/picä¸­çš„æ–‡ä»¶å¤§å°
ls -lh dist/pic/ | grep -E "\.[0-9]+ MB"
```

### ç”Ÿäº§éªŒè¯ ğŸ”„
1. ç­‰å¾… GitHub Actions å®Œæˆï¼ˆé€šå¸¸ 2-5 åˆ†é’Ÿï¼‰
2. è®¿é—®ç½‘ç«™é¦–é¡µï¼Œæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
3. Network æ ‡ç­¾ > è¿‡æ»¤ "pic" > æŸ¥çœ‹å›¾ç‰‡å¤§å°
4. åº”è¯¥çœ‹åˆ° ~100-200KB çš„ WebP æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ 1.67MB

## ç›¸å…³æ–‡ä»¶

- ğŸ”§ [scripts/process-images.js](../scripts/process-images.js) - å›¾ç‰‡å¤„ç†è„šæœ¬
- ğŸ”§ [scripts/compress-json.js](../scripts/compress-json.js) - JSONå‹ç¼©è„šæœ¬
- âš™ï¸ [vite.config.ts](../vite.config.ts) - Viteæ„å»ºé…ç½®
- ğŸ¤– [.github/workflows/deploy.yml](../.github/workflows/deploy.yml) - GitHub Actionså·¥ä½œæµ

---

**æœ€åæ›´æ–°**: 2026å¹´2æœˆ21æ—¥  
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®æ–½å’Œéƒ¨ç½²
